<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <title>DulceFinder</title>
    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='css/style.css') }}"
    />
  </head>

  <body>
    <div class="container">
      <header>
        <img
          src="{{ url_for('static', filename='img/logo.png') }}"
          alt="Logo"
          class="logo"
        />
        <img
          src="{{ url_for('static', filename='img/title.png') }}"
          alt="Dulce Finder"
          class="title"
        />
      </header>
      <form id="search-form" class="search-form">
        <input
          type="text"
          name="consulta"
          id="consulta"
          placeholder="¿Qué estás buscando?"
          required
        />
        <div class="language">
          <select name="idioma" class="language-select">
            <option value="es" selected >Español</option>
            <option value="en">English</option>
            <option value="pt">Português</option>
            <option value="de">Deutsch</option>
            <option value="fr">Français</option>
          </select>
        </div>
        <button type="submit">
          <img
            src="{{ url_for('static', filename='icon/search.svg') }}"
            alt="Buscar"
          />
        </button>
      </form>
      <div id="result-modal" class="modal hidden">
        <div class="modal-content">
          <div id="resultados"></div>
        </div>
      </div>
    </div>

    <script>
      // Traducciones para el placeholder
    const placeholders = {
      es: "¿Qué estás buscando?",
      en: "What are you looking for?",
      pt: "O que você está procurando?",
      de: "Wonach suchst du?",
      fr: "Que cherchez-vous?"
    };

    // Obtener los elementos
    const consultaInput = document.getElementById("consulta");
    const languageSelect = document.querySelector(".language-select");

    // Función para actualizar el placeholder
    function actualizarPlaceholder() {
      const idioma = languageSelect.value;
      consultaInput.placeholder = placeholders[idioma] || placeholders["es"];
    }

    // Detectar cambio de idioma
    languageSelect.addEventListener("change", actualizarPlaceholder);

    // Llamar una vez al cargar la página
    actualizarPlaceholder();
      document
        .getElementById("search-form")
        .addEventListener("submit", async (e) => {
          e.preventDefault();
          const consulta = document.getElementById("consulta").value;
          const idioma = document.querySelector(".language-select").value;

          // Realizar la petición al backend
          try {
            const response = await fetch("/buscar", {
              method: "POST",
              headers: {
                "Content-Type": "application/x-www-form-urlencoded",
              },
              body: new URLSearchParams({ consulta, idioma }),
            });
            const data = await response.json();
            renderResults(data);
          } catch (error) {
            console.error("Error en la búsqueda:", error);
          }
        });

      const categorias = {
        clases: "Clases",
        propiedades_clase: "Propiedades de la clase",
        subclases: "Subclases",
        instancias_clase: "Instancias de la clase",
        superclases: "Superclases de subclases",
        propiedades_subclase: "Propiedades de la subclase",
        individuos: "Instancias",
        clase_de_instancia: "Clase de la instancia",
        propiedades_instancia: "Propiedades de la instancia",
        usado_en_instancias: "Usado en otras instancias",
        valores: "Valores",
      };

      const categoriasPorIdioma = {
        es: {
          clases: "Clases",
          propiedades_clase: "Propiedades de la clase",
          subclases: "Subclases",
          instancias_clase: "Instancias de la clase",
          superclases: "Superclases de subclases",
          propiedades_subclase: "Propiedades de la subclase",
          individuos: "Instancias",
          clase_de_instancia: "Clase de la instancia",
          propiedades_instancia: "Propiedades de la instancia",
          usado_en_instancias: "Usado en otras instancias",
          valores: "Valores",
          dbpedia: "DBpedia",
          no_resultados: "No se encontraron resultados."
        },
        en: {
          clases: "Classes",
          propiedades_clase: "Class Properties",
          subclases: "Subclasses",
          instancias_clase: "Class Instances",
          superclases: "Superclasses of subclasses",
          propiedades_subclase: "Subclass Properties",
          individuos: "Instances",
          clase_de_instancia: "Instance Class",
          propiedades_instancia: "Instance Properties",
          usado_en_instancias: "Used in other instances",
          valores: "Values",
          dbpedia: "DBpedia",
          no_resultados: "No results found."
        },
        pt: {
          clases: "Classes",
          propiedades_clase: "Propriedades da classe",
          subclases: "Subclasses",
          instancias_clase: "Instâncias da classe",
          superclases: "Superclasses de subclasses",
          propiedades_subclase: "Propriedades da subclasse",
          individuos: "Instâncias",
          clase_de_instancia: "Classe da instância",
          propiedades_instancia: "Propriedades da instância",
          usado_en_instancias: "Usado em outras instâncias",
          valores: "Valores",
          dbpedia: "DBpedia",
          no_resultados: "Nenhum resultado encontrado."
        },
        de: {
          clases: "Klassen",
          propiedades_clase: "Klassen-Eigenschaften",
          subclases: "Unterklassen",
          instancias_clase: "Klassen-Instanzen",
          superclases: "Oberklassen der Unterklassen",
          propiedades_subclase: "Eigenschaften der Unterklasse",
          individuos: "Instanzen",
          clase_de_instancia: "Instanzklasse",
          propiedades_instancia: "Instanzeigenschaften",
          usado_en_instancias: "Verwendet in anderen Instanzen",
          valores: "Werte",
          dbpedia: "DBpedia",
          no_resultados: "Keine Ergebnisse gefunden."
        },
        fr: {
          clases: "Classes",
          propiedades_clase: "Propriétés de la classe",
          subclases: "Sous-classes",
          instancias_clase: "Instances de la classe",
          superclases: "Superclasses des sous-classes",
          propiedades_subclase: "Propriétés de la sous-classe",
          individuos: "Instances",
          clase_de_instancia: "Classe de l'instance",
          propiedades_instancia: "Propriétés de l'instance",
          usado_en_instancias: "Utilisé dans d'autres instances",
          valores: "Valeurs",
          dbpedia: "DBpedia",
          no_resultados: "Aucun résultat trouvé."
        }
      };
      function renderResults(data) {
        const contenedor = document.getElementById("resultados");
        contenedor.innerHTML = "";
        const fragment = document.createDocumentFragment();
        let hayResultados = false;

      
        const idioma = languageSelect.value;
        const categorias = categoriasPorIdioma[idioma] || categoriasPorIdioma["es"];

        // Renderizar Ontología
        Object.entries(categorias).forEach(([tipo, nombre]) => {
          const valor = data[tipo];
          if (
            valor &&
            (Array.isArray(valor)
              ? valor.length > 0
              : Object.keys(valor).length > 0)
          ) {
            hayResultados = true;
            fragment.appendChild(createSection(nombre, valor));
          }
        });

        // Renderizar DBpedia
        if (data.descripcion_dbpedia) {
          const dbpediaData = data.descripcion_dbpedia;
          if (Array.isArray(dbpediaData) && dbpediaData.length > 0) {
            fragment.appendChild(createSection("DBpedia", dbpediaData));
            hayResultados = true;
          } else if (typeof dbpediaData === "string" && dbpediaData !== "") {
            const section = document.createElement("div");
            const titulo = document.createElement("h3");
            titulo.textContent = "DBpedia";
            section.appendChild(titulo);
            const p = document.createElement("p");
            p.textContent = dbpediaData;
            section.appendChild(p);
            fragment.appendChild(section);
            hayResultados = true;
          }
        }
        if (!hayResultados) {
          const mensaje = document.createElement("p");
          mensaje.textContent = "No se encontraron resultados.";
          fragment.appendChild(mensaje);
        }
        contenedor.appendChild(fragment);
        mostrarModal();
      }
      // Función para crear secciones
      function createSection(title, items) {
        const section = document.createElement("div");
        const titulo = document.createElement("h3");
        titulo.textContent = title;
        section.appendChild(titulo);
        const ul = document.createElement("ul");

        if (Array.isArray(items)) {
          items.forEach((item) => {
            const li = document.createElement("li");
            li.textContent = item;
            ul.appendChild(li);
          });
        } else if (typeof items === "object") {
          for (const key in items) {
            const li = document.createElement("li");
            const propiedad = items[key];
            if (Array.isArray(propiedad)) {
              li.textContent = `${key}: ${propiedad.join(", ")}`;
            } else if (typeof propiedad === "object" && propiedad !== null) {
              li.textContent = `${key}:`;
              const innerUl = document.createElement("ul");
              Object.entries(propiedad).forEach(([innerKey, value]) => {
                const innerLi = document.createElement("li");
                innerLi.textContent = `${innerKey}: ${
                  Array.isArray(value) ? value.join(", ") : value
                }`;
                innerUl.appendChild(innerLi);
              });
              li.appendChild(innerUl);
            } else {
              li.textContent = `${key}: ${propiedad}`;
            }
            ul.appendChild(li);
          }
        }
        section.appendChild(ul);
        return section;
      }
      function mostrarModal() {
        document.getElementById("result-modal").classList.add("show");
      }
    </script>
  </body>
</html>
